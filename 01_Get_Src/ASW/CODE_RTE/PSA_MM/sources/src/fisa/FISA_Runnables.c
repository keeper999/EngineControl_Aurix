/******************************************************************************/
/*                                                                            */
/* !Layer :                 APPLI                                             */
/*                                                                            */
/* !Component :         FISA                                                  */
/* !Description :                                                             */
/*                                                                            */
/* !Module :            FISA_Runnables                                        */
/* !Description :       runnable											  */
/*                                                                            */
/* !File :                     FISA_Runnable.c                                */
/*                                                                            */
/* !Scope :                 Public                                            */
/*                                                                            */
/* !Target :                All                                               */
/*                                                                            */
/* !Vendor :                Valeo                                             */
/*                                                                            */
/* Coding language :  C                                                       */
/*                                                                            */
/* COPYRIGHT 2008 VALEO                                                       */
/* all rights reserved                                                        */
/*                                                                            */
/******************************************************************************/
/* PVCS Information                                                           */
/* $Archive::   P:/ACT_EMS/LOG/REF/SWC_VEMS/PSA/SWC-TURBO/FISA/5-SOFT-LIV/FISA_$*/
/* $Revision::   1.0       $$Author::   adelvare$$Date::   16 Mar 2012 14:$   */
/******************************************************************************/
/* !VnrOff : Names imposed by the customer                                    */
/******************************************************************************/
/*    RE_FISA_init                                                            */
/*    RE_FISA_CrankSync                                                       */
/******************************************************************************/


/******************************************************************************/
/* INCLUSIONS                                                                 */
/******************************************************************************/
#include "Rte_Type.h"
#include "FISA_Runnables.h"
#include "FISA_ApprentiQltCarb.h"
#include "FISA_ConfirmationApDem.h"
#include "FISA_SupervFctAdaptInj.h"
#include "FISA_nvm.h"

/******************************************************************************/
/* DECLARATION OF GLOBAL VARIABLES                                            */
/******************************************************************************/
#define FISA_START_SEC_INTERNAL_VAR_BOOLEAN
#include "FISA_MemMap.h"

VAR(Boolean,FISA_VAR) FISA_firstTime;
VAR(Boolean,AUTOMATIC) reentrance = FALSE;


#define FISA_STOP_SEC_INTERNAL_VAR_BOOLEAN
#include "FISA_MemMap.h"

/******************************************************************************/
/* DECLARATION OF VARIABLES OF MODULE                                         */
/******************************************************************************/
#define FISA_START_SEC_VAR_UNSPECIFIED
#include "FISA_MemMap.h"

_STATIC_ VAR(tstrInputFisa,FISA_VAR)  strInputFisa;
_STATIC_ VAR(tstrOutputFisa,FISA_VAR) strOutputFisa;

#define FISA_STOP_SEC_VAR_UNSPECIFIED
#include "FISA_MemMap.h"

#define FISA_START_SEC_VAR_8BIT
#include "FISA_MemMap.h"

_STATIC_ VAR(UInt8,FISA_VAR)  EtatFctFisa;

#define FISA_STOP_SEC_VAR_8BIT
#include "FISA_MemMap.h"

/******************************************************************************/
/* DEFINITION OF GLOBAL FUNCTIONS                                             */
/******************************************************************************/


/******************************************************************************/
/* DEFINITION OF FUNCTIONS OF MODULE                                          */
/******************************************************************************/

#define FISA_START_SEC_CODE
#include "FISA_MemMap.h"

#define FISA_ACTIF				((UInt8)0)
#define FISA_INHIBITION			((UInt8)1)
#define FISA_WAIT_ACTIVATION	((UInt8)2)
#define DRIVEN_START			((UInt8)3)

_STATIC_ FUNC(void,FISA_CODE) FISA_ReadInput(void);
_STATIC_ FUNC(void,FISA_CODE) FISA_WriteOutPut(void);
_STATIC_ FUNC(void,FISA_CODE) FISA_Optimisation(void);
_STATIC_ FUNC(void,FISA_CODE) FISA_Optimisation_Init(void);

/*==============================================================================
** Name: FISA_ReadInput
** Description:
** Ecriture des entrees FISA dans la structure strInputFisa
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/


_STATIC_ FUNC(void,FISA_CODE) FISA_ReadInput(void)
{
  VAR(Std_ReturnType,AUTOMATIC)    res;

  res = RTE_E_OK ;

  res |= Rte_Read_R_Ext_tCoMes_Ext_tCoMes(&strInputFisa.s16Ext_tCoMes);
  res |= Rte_Read_R_Ext_nEng_Ext_nEng(&strInputFisa.u16Ext_nEng);
  res |= Rte_Read_R_TqSys_nTarIdl_TqSys_nTarIdl(&strInputFisa.u16TqSys_nTarIdl);
  res |= Rte_Read_R_Ext_ctInj_Ext_ctInj(&strInputFisa.u16Ext_ctInj);
  res |= Rte_Read_R_Ext_uBattMes_Ext_uBattMes(&strInputFisa.s16uBattMes);
  res |= Rte_Read_R_Ext_pAirExtMes_Ext_pAirExtMes(&strInputFisa.u16Ext_pAirExtMes);
  res |= Rte_Read_R_Veh_spdVeh_Veh_spdVeh(&strInputFisa.u16Veh_spdVeh);
  res |= Rte_Read_R_Ext_bSync_Ext_bSync(&strInputFisa.bExt_bSync);
  res |= Rte_Read_R_Ext_bStrtEnd_Ext_bStrtEnd(&strInputFisa.bExt_bStrtEnd);
  res |= Rte_Read_R_Ext_bIdlAcv_Ext_bIdlAcv(&strInputFisa.bExt_bIdlAcv);
  res |= Rte_Read_R_CoPt_noEgdGearCord_CoPt_noEgdGearCord(&strInputFisa.u8CoPt_noEgdGearCord);
  res |= Rte_Read_R_Eng_rAirLd_Eng_rAirLd(&strInputFisa.u16Eng_rAirLd);
  res |= Rte_Read_R_AFReg_bAFRegAcv_AFReg_bAFRegAcv(&strInputFisa.bAFReg_bAFRegAcv);
  res |= Rte_Read_R_AFReg_facCorRich_AFReg_facCorRich(&strInputFisa.u16AFReg_facCorRich);
  res |= Rte_Read_R_AccP_rAccP_AccP_rAccP(&strInputFisa.u16AccP_rAccP);
  res |= Rte_Read_R_Ext_bCluPedPrss_Ext_bCluPedPrss(&strInputFisa.bExt_bCluPedPrss);
  res |= Rte_Read_R_Ext_stGBxCf_Ext_stGBxCf(&strInputFisa.u8Ext_stGBxCf);
  res |= Rte_Read_R_Ext_bFirstStrt_Ext_bFirstStrt(&strInputFisa.bExt_bFirstStrt);
  res |= Rte_Read_R_Ext_bEngReStrt_Ext_bEngReStrt(&strInputFisa.bExt_bEngReStrt);
  res |= Rte_Read_R_FISA_bPoor_FISA_bPoor(&strInputFisa.bFISA_bPoor);
  res |= Rte_Read_R_FISA_bRich_FISA_bRich(&strInputFisa.bFISA_bRich);
  res |= Rte_Read_R_FISA_bInhFISA_FISA_bInhFISA(&strInputFisa.bFISA_bInhFISA);
  res |= Rte_Read_R_FISA_bInhInst_FISA_bInhInst(&strInputFisa.bFISA_bInhInst);
  res |= Rte_Read_R_RFuDet_bRstAdp_RFuDet_bRstAdp(&strInputFisa.bRFuDet_bRstAdp);
  res |= Rte_Read_R_FISA_facRst_FISA_facRst(&strInputFisa.u8FISA_facRst);
  res |= Rte_Read_R_Ext_tiTDC_Ext_tiTDC(&strInputFisa.u8Ext_tiTDC);
  res |= Rte_Read_R_CoPTSt_stEng_CoPTSt_stEng(&strInputFisa.CoPTSt_stEng);

  if (RTE_E_OK != res)
  {
      FISA_erreur(FISA_ERREUR_READERROR);
  }
}

/*==============================================================================
** Name: FISA_WriteOutPut
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/

_STATIC_ FUNC(void,FISA_CODE) FISA_WriteOutPut(void)
{
  VAR(Std_ReturnType,AUTOMATIC)    res;

  res = Rte_Write_P_FISA_bAuthSave_FISA_bAuthSave(strOutputFisa.bFISA_bAuthSave);
  res = Rte_Write_P_FISA_facAdp_FISA_facAdp(FISA_sNV_Z1_CST_8BIT_1.FISA_facAdp_NV);
  res = Rte_Write_P_FISA_bGrdWin_FISA_bGrdWin(strOutputFisa.bFISA_bGrdWin);
  res = Rte_Write_P_FISA_bInstWin_FISA_bInstWin(strOutputFisa.bFISA_bInstWin);
  res = Rte_Write_P_FISA_bAFRegWin_FISA_bAFRegWin(strOutputFisa.bFISA_bAFRegWin);
  res = Rte_Write_P_FISA_bRstAdpDone_FISA_bRstAdpDone(strOutputFisa.bFISA_bRstAdpDone);
}

/*==============================================================================
** Name: FISA_Optimisation_Init
** Description:
** Initialisation Gestion des activations/inhibitions du superviseur
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/

_STATIC_ FUNC(void,FISA_CODE) FISA_Optimisation_Init(void)
{
  FISA_firstTime = TRUE;
  EtatFctFisa = FISA_ACTIF;
}
/*==============================================================================
** Name: FISA_Optimisation
** Description:
** Gestion des activations/inhibitions du superviseur
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/

_STATIC_ FUNC(void,FISA_CODE) FISA_Optimisation(void)
{
  switch (EtatFctFisa)
  {
    case FISA_ACTIF:
	  if (strInputFisa.u16Ext_nEng > FISA_nEngThdDeac_C)
	  {
		EtatFctFisa = FISA_INHIBITION;
	  }
	  else
	  {
		FISA_MachineCalculCalib();/*Appel de la fonction des calculs de Calibration*/
        FISA_Sup_Step_M_Strategie();
        FISA_ApprentiQltCarb_main();
        FISA_ConfirmationApDem_main();
        FISA_DetermFuelQuality();
	  }
	  break;
    case FISA_INHIBITION:
	  if (strInputFisa.CoPTSt_stEng != ((UInt8) DRIVEN_START))
	  {
		EtatFctFisa = FISA_WAIT_ACTIVATION;
	  }
	  break;
    case FISA_WAIT_ACTIVATION:
	  if (strInputFisa.CoPTSt_stEng == ((UInt8) DRIVEN_START))
	  {
		 EtatFctFisa = FISA_ACTIF;
		 FISA_SupervInit();
		 FISA_ApprentiQltCarb_Init();
       FISA_ConfirmInit();
       FISA_DetermInit();

	    FISA_MachineCalculCalib();
       FISA_Sup_Step_M_Strategie();
       FISA_ApprentiQltCarb_main();
       FISA_ConfirmationApDem_main();
       FISA_DetermFuelQuality();
	  }
	  break;
    default:
      FISA_erreur(FISA_ERREUR_SUPERVFCTOPTI);
	  break;
  }
}

/*==============================================================================
** Name: FISA_GetExt_ctInj
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_ctInj(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16Ext_ctInj;
}

/*==============================================================================
** Name: FISA_GetExt_ctInj
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_nEng(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16Ext_nEng;
}

/*==============================================================================
** Name: FISA_GetuExt_pAirExtMes
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_pAirExtMes(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16Ext_pAirExtMes;
}

/*==============================================================================
** Name: FISA_GetExt_tCoMes
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_tCoMes(P2VAR(SInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.s16Ext_tCoMes;
}

/*==============================================================================
** Name: FISA_GetuBattMes
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetuBattMes(P2VAR(SInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.s16uBattMes;
}

/*==============================================================================
** Name: FISA_GetVeh_spdVeh
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetVeh_spdVeh(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16Veh_spdVeh;
}

/*==============================================================================
** Name: FISA_GetExt_bEngReStrt
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_bEngReStrt(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bEngReStrt;
}

/*==============================================================================
** Name: FISA_GetExt_Ext_bSync
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_Ext_bSync(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bSync;
}

/*==============================================================================
** Name: FISA_GetExt_bStrtEnd
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_bStrtEnd(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bStrtEnd;
}

/*==============================================================================
** Name: FISA_GetExt_bIdlAcv
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_bIdlAcv(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bIdlAcv;
}

/*==============================================================================
** Name: FISA_GetCoPt_noEgdGearCord
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetCoPt_noEgdGearCord(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u8CoPt_noEgdGearCord;
}

/*==============================================================================
** Name: FISA_GetEng_rAirLd
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetEng_rAirLd(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16Eng_rAirLd;
}

/*==============================================================================
** Name: FISA_GetAFReg_bAFRegAcv
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetAFReg_bAFRegAcv(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bAFReg_bAFRegAcv;
}

/*==============================================================================
** Name: FISA_GetAccP_rAccP
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetAccP_rAccP(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16AccP_rAccP;
}

/*==============================================================================
** Name: FISA_GetExt_bFirstStrt
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_bFirstStrt(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bFirstStrt;
}

/*==============================================================================
** Name: FISA_GetTqSys_nTarIdl
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetTqSys_nTarIdl(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u16TqSys_nTarIdl;
}

/*==============================================================================
** Name: FISA_GetExt_bCluPedPrss
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_bCluPedPrss(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bExt_bCluPedPrss;
}

/*==============================================================================
** Name: FISA_GetPoor
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetPoor(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bFISA_bPoor;
}

/*==============================================================================
** Name: FISA_GetRich
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetRich(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bFISA_bRich;
}

/*==============================================================================
** Name: FISA_GetInhFISA
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetInhFISA(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bFISA_bInhFISA;
}

/*==============================================================================
** Name: FISA_GetInhInst
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetInhInst(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bFISA_bInhInst;
}

/*==============================================================================
** Name: FISA_GetRFuDet_bRstAdp
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetRFuDet_bRstAdp(P2VAR(Boolean, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.bRFuDet_bRstAdp;
}

/*==============================================================================
** Name: FISA_GetExt_tiTDC
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_tiTDC(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u8Ext_tiTDC;
}

/*==============================================================================
** Name: FISA_GetAFReg_facCorRich
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetAFReg_facCorRich(P2VAR(UInt16, FISA_APPL_DATA, AUTOMATIC) value)
{
  UInt16 calcul;
  /* Stil CSEO_CLCO08_0671_2.2 : Resol de 2^-7 -> conversion en 0.01 car elle est utilisée en 0.01 dans le code */
  calcul = (UInt16) ((strInputFisa.u16AFReg_facCorRich * 100 + 64) / 128);
  *value = calcul;
}

/*==============================================================================
** Name: FISA_GetfacRst
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetfacRst(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  UInt8 calcul;
  /* FISA_facRst a une resol de 0.0078125 d'apres la stil CSEO_CLCO08_0671_2.2, donc on le met dans une resol de 0.01 (VEMS V02 ECU#058873) */
  calcul = (UInt8) ((strInputFisa.u8FISA_facRst * 100 + 64) / 128);
  *value = calcul;
}

/*==============================================================================
** Name: FISA_GetfacOld
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetfacOld(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = FISA_sNV_Z1_CST_8BIT_1.FISA_facAdp_NV;
}


/*==============================================================================
** Name: FISA_GetExt_stGBxCf
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetExt_stGBxCf(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.u8Ext_stGBxCf;
}

/*==============================================================================
** Name: FISA_GetCoPTSt_stEng
** Description:
** Lecture entree FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_GetCoPTSt_stEng(P2VAR(UInt8, FISA_APPL_DATA, AUTOMATIC) value)
{
  *value = strInputFisa.CoPTSt_stEng;
}

/*==============================================================================
** Name: FISA_Update_facAdp
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_facAdp(UInt8 value)
{
   UInt8 u8local_sat;
   u8local_sat = Saturation_INT_U8(value, 128, 0);
   
	FISA_sNV_Z1_CST_8BIT_1.FISA_facAdp_NV = u8local_sat;
}

/*==============================================================================
** Name: FISA_Update_bAuthSave
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_bAuthSave(Boolean value)
{
  strOutputFisa.bFISA_bAuthSave = value;
}

/*==============================================================================
** Name: FISA_Update_bGrdWin
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_bGrdWin(Boolean value)
{
  strOutputFisa.bFISA_bGrdWin = value;
}

/*==============================================================================
** Name: FISA_Update_bInstWin
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_bInstWin(Boolean value)
{
  strOutputFisa.bFISA_bInstWin = value;
}

/*==============================================================================
** Name: FISA_Update_bAFRegWin
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_bAFRegWin(Boolean value)
{
  strOutputFisa.bFISA_bAFRegWin = value;
}

/*==============================================================================
** Name: FISA_Update_bRstAdpDone
** Description:
** Ecriture des sorties FISA
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference:																		*/
/*                                                                                  */
/************************************************************************************/
FUNC(void,FISA_CODE) FISA_Update_bRstAdpDone(Boolean value)
{
  strOutputFisa.bFISA_bRstAdpDone = value;
}

/*==============================================================================
** Name: RE_FISA_init
** Description:
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference: CSMT CGMT07 0378 V1.3                                                */
/* !Trace_To : GEENSYS_EXI_CODE_IMPL_FISA_DETERMINIT                                */
/*                                                                                  */
/************************************************************************************/
/* !LastAuthor  : S.Corbe (GEENSYS)                                                 */
/************************************************************************************/

FUNC(void, FISA_CODE) RE_FISA_init(void)
{
  reentrance = FALSE;

  FISA_ReadInput();

  FISA_Optimisation_Init();
  FISA_SupervInit();
  FISA_ApprentiQltCarb_Init();
  FISA_ConfirmInit();
  FISA_DetermInit();
  FISA_WriteOutPut();
}
/*==============================================================================
** Name: RE_FISA_CrankSync
** Description:
**------------------------------------------------------------------------------
** IN:
**------------------------------------------------------------------------------
** OUT:
**------------------------------------------------------------------------------
** IN/OUT:
**------------------------------------------------------------------------------
** RTE DataReceivePoint
**------------------------------------------------------------------------------
** RTE DataSendPoint
** UInt8 FISA_facAdp
**  Min = 0 Max = 128 Prec = 0.0078125
** Boolean FISA_bAuthSave
**  Min = 0 Max = 1 Prec = 1
** Boolean FISA_bGrdWin
**  Min = 0 Max = 1 Prec = 1
** Boolean FISA_bInstWin
**  Min = 0 Max = 1 Prec = 1
** Boolean FISA_bAFRegWin
**  Min = 0 Max = 1 Prec = 1
** Boolean FISA_bRstAdpDone
**  Min = 0 Max = 1 Prec = 1
**------------------------------------------------------------------------------
** RTE Read IRV:
**------------------------------------------------------------------------------
** RTE Written IRV:
**============================================================================*/
/************************************************************************************/
/*                                                                                  */
/* !Reference: CSMT CGMT07 0378 V1.3                                                */
/* !Trace_To : GEENSYS_EXI_CODE_TU                                                  */
/*                                                                                  */
/************************************************************************************/
/* !LastAuthor  : S.Corbe (GEENSYS)                                                 */
/************************************************************************************/

FUNC(void, FISA_CODE) RE_FISA_CrankSync(void)
{

  VAR(Std_ReturnType,AUTOMATIC)   ret;

  /* QAC dit que 'reetrance' est toujours affecte avant ce test
     ce qui est faux car reetrance est static */
  if ( FALSE == reentrance )/*test de la reentrance*/
  {
    reentrance = TRUE ;

    if ( FISA_INTEGRATION_TESTS_SC == TRUE )
    {
      /*Forcage des sorties avec les valeurs de calibration Bypassees*/
      ret =  Rte_Write_P_FISA_facAdp_FISA_facAdp(FISA_facAdp_BypC);
      ret |= Rte_Write_P_FISA_bAuthSave_FISA_bAuthSave(FISA_bAuthSave_BypC);
      ret |= Rte_Write_P_FISA_bGrdWin_FISA_bGrdWin(FISA_bGrdWin_BypC);
      ret |= Rte_Write_P_FISA_bInstWin_FISA_bInstWin(FISA_bInstWin_BypC);
      ret |= Rte_Write_P_FISA_bAFRegWin_FISA_bAFRegWin(FISA_bAFRegWin_BypC);
      ret |= Rte_Write_P_FISA_bRstAdpDone_FISA_bRstAdpDone(FISA_bRstAdpDone_BypC);

      if (ret != RTE_E_OK)
      {
        FISA_erreur(FISA_ERREUR_WRITEERROR);
      }
    }
    else
    {
	  FISA_ReadInput();
	  FISA_Optimisation();
	  FISA_WriteOutPut();
	  FISA_firstTime = FALSE;

    }
    reentrance = FALSE ;
  }
}

#define FISA_STOP_SEC_CODE
#include "FISA_MemMap.h"
